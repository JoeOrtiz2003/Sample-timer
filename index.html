<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta author="ErouiNeurs">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Synced Countdown Timer</title>

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="main__container"></div>

  <script>
    function e(id) {
      return document.getElementById(id);
    }

    function runTemplateUpdate() {
      const wrapper = document.querySelector('.main__container');
      wrapper.innerHTML = layouts["style.css"].objects;
      new layouts["style.css"].Element(wrapper);
    }

    class PMPLElement {
      constructor(wrapper) {
        this.duration = 20000; // in ms
        this.startTime = null;
        this.running = true;
        this.maxWidth = 840; // bar width in px

        requestAnimationFrame(this.animate.bind(this));
      }

      animate(timestamp) {
        if (!this.running) return;
        if (!this.startTime) this.startTime = timestamp;

        const elapsed = timestamp - this.startTime;
        const remaining = Math.max(this.duration - elapsed, 0);

        // Update timer text
        const seconds = Math.floor(remaining / 1000);
        const milliseconds = Math.floor(remaining % 1000);
        e("timer").innerText = seconds < 10 ? ` ${seconds}` : seconds;
        e("sub_timer").innerText = milliseconds.toString().padStart(3, '0');

        // Update bar width
        const progressRatio = remaining / this.duration;
        const newWidth = this.maxWidth * progressRatio;
        const bar = document.querySelector(".line__object");
        bar.style.width = `${newWidth}px`;

        if (remaining > 0) {
          requestAnimationFrame(this.animate.bind(this));
        } else {
          this.running = false;
          e("timer").innerText = " 0";
          e("sub_timer").innerText = "000";
        }
      }
    }

    const layouts = {
      ["style.css"]: {
        objects: `
          <div class="pmpl__container">
            <div class="timer__container">
              <p class="timer__item" id="timer">20</p>
              <p class="timer_sub__object" id="sub_timer">000</p>
            </div>
            <div class="info__container">
              <p class="info__text" id="info_text_primary">circle</p>
              <p class="info__text" id="info_text_secondary">closing in</p>
            </div>
            <div class="line__container">
              <div class="line__object"></div>
            </div>
          </div>
        `,
        Element: PMPLElement,
      }
    };

    window.onload = runTemplateUpdate;
  </script>
</body>
</html>
