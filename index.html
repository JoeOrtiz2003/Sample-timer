<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta author="ErouiNeurs">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BLUE CIRCLE TIMER</title>

  <link rel="stylesheet" href="style.css">
  <link id="dynamic" rel="stylesheet" href="style.css">
</head>

<body>
  <div class="main__container"></div>

  <!-- GSAP animation library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <script>
    function e(id) {
      return document.getElementById(id);
    }

    function runTemplateUpdate() {
      const wrapper = document.querySelector('.main__container');
      wrapper.innerHTML = layouts["style.css"].objects;
      new layouts["style.css"].Element(wrapper);
    }

    class PMPLElement {
      constructor(wrapper) {
        this.duration = 20000; // in ms
        this.startTime = null;
        this.running = true;

        this.startAnimation();
        requestAnimationFrame(this.animateCountdown.bind(this));
      }

      startAnimation() {
        // Fade in container
        gsap.to(".pmpl__container", {
          duration: 0.5,
          opacity: 1,
          ease: "linear"
        });

        // Animate the bar
        gsap.to(".pmpl__container .line__object", {
          duration: this.duration / 1000,
          ease: "linear",
          width: 0
        });
      }

      animateCountdown(timestamp) {
        if (!this.running) return;
        if (!this.startTime) this.startTime = timestamp;

        const elapsed = timestamp - this.startTime;
        const remaining = Math.max(this.duration - elapsed, 0);

        const seconds = Math.floor(remaining / 1000);
        const milliseconds = Math.floor(remaining % 1000);

        e("timer").innerText = seconds < 10 ? ` ${seconds}` : seconds;
        e("sub_timer").innerText = milliseconds.toString().padStart(3, '0');

        if (remaining > 0) {
          requestAnimationFrame(this.animateCountdown.bind(this));
        } else {
          this.running = false;
          e("timer").innerText = ' 0';
          e("sub_timer").innerText = '000';
        }
      }

      stopAnimation() {
        this.running = false;

        gsap.to(".pmpl__container", {
          duration: 0.25,
          ease: "linear",
          opacity: 0
        });

        const bar = document.querySelector(".pmpl__container .line__object");
        if (bar) bar.style.width = "840px";
      }
    }

    const layouts = {
      ["style.css"]: {
        objects: `
          <div class="pmpl__container">
            <div class="timer__container">
              <p class="timer__item" id="timer">20</p>
              <p class="timer_sub__object" id="sub_timer">000</p>
            </div>
            <div class="info__container">
              <p class="info__text" id="info_text_primary">circle</p>
              <p class="info__text" id="info_text_secondary">closing in</p>
            </div>
            <div class="line__container">
              <div class="line__object"></div>
            </div>
          </div>
        `,
        Element: PMPLElement,
      }
    };

    window.onload = runTemplateUpdate;
  </script>
</body>
</html>
